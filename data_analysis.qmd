---
title: "Exploring nutrition status- data analysis"
author: "Eric Anku"
format: docx
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```


```{r import-libraries}
# Import libraries
pacman::p_load(
        tidyverse, # Data wrangling and plotting
        googlesheets4, # Import dataset
        anthro, # Prevalence and z-scores
        gtsummary, # Table summaries
        ggstatsplot, # Exploratory plots
        GGally, # Scatterplot matrix
        statsr, # Inferential statistics
        skimr, # Statistical summary
        finalfit, # Labelling, glimpse, and modelling
        janitor, # Data cleaning
        broom, # Tidy data output
        rstatix, # Normality test
        here,
        rio

)
```

```{r import-dataset}
cwc <- import(here("data", "cwc_zscore.csv"))
```

```{r cwc-two-remove-variables}
cwc <- cwc%>%
  select(-c(included, name, age_in_days, age_in_months, cmeasure, oedema, clenhei, cbmi, csex, zlen_flag,
            zwei_flag, zbmi_flag, zwfl_flag, zbmi, age, age_group))
```

```{r factor-sex}
cwc <- cwc%>%
  mutate(
    sex = factor(sex)%>%
      fct_recode(
        "Male" = "1",
        "Female" = "2"
      )
  )
```


```{r malnutrition-category}
cwc <- cwc%>%
  mutate (
    stunting = case_when(
      zlen < - 2 & zlen >= -6 ~ "Stunting",
      zlen >= -2 & zlen <= 6 ~ "Normal",
      TRUE ~ "Flag"
    ),
    wasting = case_when(
      zwfl < - 2 & zwfl >= -5 ~ "Wasting",
      zwfl >= -2 & zwfl <= 5 ~ "Normal",
      TRUE ~ "Flag"
    ),
    underweight = case_when(
      zwei < -2 & zwei >= -6 ~ "Underweight",
      zwei >= -2 & zwei <= 5 ~ "Normal",
      TRUE ~ "Flag"
    )
  )
```

```{r remove-flags}
cwc <- cwc%>%
  mutate(
    stunting = cwc%>%
      filter(stunting != "Flag"),
    wasting = cwc%>%
      filter(wasting != "Flag"),
    underweight = cwc%>%
      filter(underweigh != "Flag")
  )
```


```{r labelling-cwc}
cwc <- cwc%>%
  mutate(
    sex = ff_label(sex, "Sex"),
    age_months = ff_label(age_months, "Age (months)"),
    weight = ff_label(weight, "Weight (kg)"),
    lenhei = ff_label(lenhei, "Length/Height (cm)"),
    bwt = ff_label(bwt, "Birth weight (kg)"),
    stunting = ff_label(stunting, "Stunting"),
    wasting = ff_label(wasting, "Wasting"),
    underweight = ff_label(underweight, "Underweight")
  )
```


```{r skim-dataset, eval=FALSE}
# Skim dataset
skim(cwc)
```


## Tables


```{r table-one}
cwc%>%
        tbl_summary(missing_text = "Missing data",
                    statistic = list(c(weight, lenhei, bwt, zwei, zlen, zwfl) ~ "{mean} ({sd})"))%>%add_ci()
```


```{r table_two}
cwc%>%
        tbl_summary(by = sex,
                    missing_text = "Missing data",
                     statistic = list(c(weight, lenhei, bwt, zwei, zlen, zwfl) ~ "{mean} ({sd})")
                    )%>%
        add_p(
                # list(all_continuous() ~ "t.test")
        )%>%
        bold_p()%>%
        bold_labels()
```




